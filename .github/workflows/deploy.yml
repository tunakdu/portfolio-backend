name: Deploy to Production

on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Deploy to server
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USERNAME }}
        password: ${{ secrets.VPS_PASSWORD }}
        port: ${{ secrets.VPS_PORT || 22 }}
        timeout: 300s
        script: |
          echo "ðŸš€ GitHub Actions deployment baÅŸlatÄ±lÄ±yor..."
          cd /home/tunakdu/web/akduhan.com/public_html
          
          # Backup .env
          cp .env .env_backup 2>/dev/null || true
          
          # Git update (protect important files and uploads)
          git reset --hard HEAD
          git clean -fd -e .env -e storage/app/public/articles/ -e storage/logs/ -e ssl/
          git pull origin master
          
          # Restore .env
          cp .env_backup .env 2>/dev/null || true
          rm -f .env_backup
          
          
          # Run deployment script
          chmod +x deploy.sh
          ./deploy.sh
          
          echo "âœ… GitHub Actions deployment completed!"